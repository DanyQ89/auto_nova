<script>
    document.getElementById('addDetailBtn').onclick = function() {
        openModal('add');
    };

    function openModal(action, detail = {}) {
        const modal = document.getElementById('detailModal');
        const title = document.getElementById('modalTitle');
        const detailId = document.getElementById('detailId');
        const nameInput = document.getElementById('name');
        const priceInput = document.getElementById('price');
        const priceWDiscountInput = document.getElementById('price_w_discount');
        const dateInput = document.getElementById('data_created');
        const commentInput = document.getElementById('comment');
        const origNumberInput = document.getElementById('orig_number'); // Поле оригинального номера
        const conditionInput = document.getElementById('condition');
        const percentInput = document.getElementById('percent'); // Поле для процента
        const cpkInput = document.getElementById('CpK'); // Поле для CpK
        const colorInput = document.getElementById('color');
        const skladInput = document.getElementById('sklad'); // Поле для склада
        const idDetailInput = document.getElementById('ID_detail'); // Поле для уникального ID детали
        const brandInput = document.getElementById('brand'); // Поле для бренда
        const modelAndYearInput = document.getElementById('model_and_year'); // Поле для модели и года
        const submitButton = document.getElementById('submitButton'); // Получаем кнопку

        if (action === 'edit') {
            title.textContent = 'Редактировать деталь';
            detailId.value = detail.id;
            skladInput.value = detail.sklad || ''; // Заполняем поле склада
            idDetailInput.value = detail.ID_detail || ''; // Заполняем уникальный ID детали
            brandInput.value = detail.brand || ''; // Заполняем поле бренда
            modelAndYearInput.value = detail.model_and_year || ''; // Заполняем поле модели и года
            nameInput.value = detail.name || '';
            priceInput.value = detail.price || '';
            priceWDiscountInput.value = detail.price_w_discount || '';
            dateInput.value = detail.data_created || ''; // Заполняем дату добавления
            commentInput.value = detail.comment || '';
            origNumberInput.value = detail.orig_number || ''; // Заполняем оригинальный номер
            conditionInput.value = detail.condition || '';
            percentInput.value = detail.percent || 0; // Заполняем процент
            cpkInput.value = detail.CpK || ''; // Заполняем CpK
            colorInput.value = detail.color || '';
            submitButton.textContent = 'Обновить данные'; // Изменяем текст кнопки
        } else {
            title.textContent = 'Добавить деталь';
            detailId.value = '';
            skladInput.value = '';
            idDetailInput.value = '';
            brandInput.value = '';
            modelAndYearInput.value = '';
            nameInput.value = '';
            priceInput.value = '';
            priceWDiscountInput.value = '';
            dateInput.value = '';
            commentInput.value = '';
            origNumberInput.value = ''; // Очищаем оригинальный номер
            conditionInput.value = '';
            percentInput.value = 0; // Сбрасываем процент
            cpkInput.value = ''; // Очищаем CpK
            colorInput.value = '';
            submitButton.textContent = 'Сохранить'; // Устанавливаем текст кнопки по умолчанию
        }
        modal.style.display = 'block';
    }

    function closeModal() {
        document.getElementById('detailModal').style.display = 'none';
    }

    window.onclick = function(event) {
        const modal = document.getElementById('detailModal');
        if (event.target === modal) {
            closeModal();
        }
    }

    function editDetail(detailId) {
        // Здесь вы должны сделать запрос на сервер, чтобы получить данные детали по ID
        fetch(`/update_detail/${detailId}`)
            .then(response => response.json())
            .then(detail => {
                openModal('edit', detail);
            })
            .catch(error => console.error('Ошибка:', error));
    }
</script>